https://www.cnblogs.com/vveiliang/p/6643874.html


在编程中一个幂等操作的特点是其 **任意多次执行所产生的影响均与一次执行的影响相同**。

幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。

在事务提交失败会重复提交达到最大重复次数时返回失败的 设计中  保持幂等性是尤为重要的


例子：

### 方法一、单次支付请求，也就是直接支付了，不需要额外的数据库操作了，这个时候发起异步请求创建一个唯一的ticketId，就是门票，这张门票只能使用一次就作废，具体步骤如下：

1. 异步请求获取门票

2. 调用支付，传入门票

3. 根据门票ID查询此次操作是否存在，如果存在则表示该操作已经执行过，直接返回结果；如果不存在，支付扣款，保存结果

4. 返回结果到客户端

如果步骤4通信失败，用户再次发起请求，那么最终结果还是一样的.

### 方法二、分布式环境下各个服务相互调用

这边就要举例我们的系统了，我们支付的时候先要扣款，然后更新订单，这个地方就涉及到了订单服务以及支付服务了。

用户调用支付，扣款成功后，更新对应订单状态，然后再保存流水。

而在这个地方就没必要使用门票ticketId了，因为会比较闲的麻烦

（支付状态：未支付，已支付）

步骤：

1. 查询订单支付状态

2. 如果已经支付，直接返回结果

3. 如果未支付，则支付扣款并且保存流水

4. 返回支付结果

如果步骤4通信失败，用户再次发起请求，那么最终结果还是一样的
